@inject IApplicationPictureLogic Service
@inject IApplicationUserServices UserService
@inject IUtilityService UtilityService
@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager

<environment include="Development">
    <link rel="stylesheet" href="~/css/PartialLogin.css" />
</environment>

@if (SignInManager.IsSignedIn(User))
{
    var userId = UserManager.GetUserId(User);
    <ul class="navbar-nav">
        <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" id="notificationNotice" data-toggle="dropdown" href="#">
                <i class="fa fa-bell"></i>
            </a>
            <div class="dropdown-menu">
                <ul id="displayNotifications">
                    @{
                        var notifications = UtilityService.GetAllNotificationsForUser(userId);
                        if (notifications.Count > 0)
                        {
                            foreach (var notification in notifications)
                            {
                                <li>
                                    <h6>
                                        <i class="fa fa-exclamation-circle"></i> @notification.Content
                                    </h6>
                                </li>
                            }

                            <li>
                                <h6 class="text-center" id="readNotifications">
                                    <a onclick="readNotifications('@userId')" href="#">Read all (@notifications.Count)</a>
                                </h6>                             
                            </li>
                        }
                        else
                        {
                            <li>
                                <h6>No new notification at this moment</h6>
                            </li>
                        }
                    }
                </ul>
            </div>
        </li>
        <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#">
                @{
                    if (Service.CheckIfHasProfilePicture(userId))
                    {
                        <i class="fa fa-user"></i>
                    }
                    else
                    {
                        <img class="rounded" id="navigationPicture" src="@Url.Content("..\\..\\..\\" + Service.GetFolderWithFile(userId))"/>
                    }

                    <span>@Service.GetNameOfTheSpecifiedId(userId)</span>
                }
            </a>
            <div class="dropdown-menu">
                <a class="dropdown-item" asp-area="" asp-controller="Users" asp-route-username="@UserService.GetApplicationUserById(Guid.Parse(userId)).User" asp-action="Index">Profile</a>
                <a class="dropdown-item" asp-area="" asp-controller="Books" asp-action="Index">Explore</a>
                <a class="dropdown-item" asp-area="" asp-controller="BooksForMood" asp-action="Index">Community</a>
                <a class="dropdown-item disabled" asp-area="">Announcements</a>

                <div class="dropdown-divider"></div>

                <a class="dropdown-item" asp-area="" asp-controller="Manage" asp-action="Index">Settings <i class="fa fa-cog"></i></a>

                <div class="dropdown">
                    <form class="form-inline" asp-controller="Account" asp-action="Logout" method="post" id="logoutForm">
                        <button type="submit" class="btn-logout">Logout <i class="fa fa-sign-out"></i></button>
                    </form>
                </div>
            </div>
        </li>
    </ul>
}
else
{
    <ul class="navbar-nav">
        <li>
            <a class="nav-link" asp-area="" asp-controller="Account" asp-action="Register"><span>Register <i class="fa fa-user-plus"></i></span></a>
        </li>
        <li>
            <a class="nav-link" asp-area="" asp-controller="Account" asp-action="Login"><span>Login <i class="fa fa-sign-in"></i></span></a>
        </li>
    </ul>
}
